<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <style type="text/css">
            
        </style>
        <script type="text/javascript" src="d3/d3-master/d3.js"></script>
    </head>
    <body>

        <a href="http://kanyikd.github.io/Exercise.ipynb" target="_blank">Download</a><br>

        <!--Assignment 2A-->

        <svg width="280" height="140">
            <rect x="0" y="60" width="80" height="80" fill="purple" opacity="1" stroke="gray" stroke-width="2"></rect> 
            <rect x="50" y="45" width="80" height="80" fill="blue" opacity="0.8" stroke="gray" stroke-width="2"></rect>
            <rect x="100" y="30" width="80" height="80" fill="green" opacity="0.6" stroke="gray" stroke-width="2"></rect>
            <rect x="150" y="15" width="80" height="80" fill="yellow" opacity="0.4" stroke="gray" stroke-width="2"></rect>
            <rect x="200" y="0" width="80" height="80" fill="red" opacity="0.2" stroke="gray" stroke-width="2"></rect>
        </svg>
        <br>

        <!--Assignment 2B-->

        <p>hit the button</p><br>
        <script type="text/javascript">

                var w = 750;
                var h = 500;
                var padding = 60;

                var dataset2003=[];
                var dataset2015=[];
                var x;

                d3.json("2003.json", function(data) {
                    for (var i = 0, l=data.length, k=0, j=0; i <l; i++) {
                        if (data[i]['YEAR']==2003) {
                            dataset2003.push([]);
                            dataset2003[k].push(data[i]['DISTRICT']);
                            dataset2003[k].push(data[i]["VEHICLETHEFT"]); 
                            dataset2003[k].push(data[i]["PROSTITUTION"]);
                            k++;
                        }
                        else {
                            dataset2015.push([]);
                            dataset2015[j].push(data[i]['DISTRICT']);
                            dataset2015[j].push(data[i]["VEHICLETHEFT"]); 
                            dataset2015[j].push(data[i]["PROSTITUTION"]); 
                            j++; 
                        };
                    };

                    x=dataset2003;

                    var arrayVehicletheft2003=[];

                    for (var i =0, l=dataset2003.length ; i < l; i++) {
                        arrayVehicletheft2003.push(dataset2003[i][1]);
                    };

                    var arrayProstitution2003=[];

                    for (var i =0, l=dataset2003.length ; i < l; i++) {
                        arrayProstitution2003.push(dataset2003[i][2]);
                    };

                    //var maxProstitution2003=Math.max(arrayProstitution2003);

                    function getMaxOfArray(numArray) {
                        return Math.max.apply(null, numArray);
                    }

                    var maxProstitution2003=getMaxOfArray(arrayProstitution2003);
                    var maxVehicletheft2003=getMaxOfArray(arrayVehicletheft2003);

                    var xScale = d3.scale.linear()
                                         .domain([0, d3.max(dataset2003, function(d) { return d[2]; })])
                                         .range([padding, w - padding * 2]);

                    var yScale = d3.scale.linear()
                                         .domain([0, d3.max(dataset2003, function(d) { return d[1]; })])
                                         .range([h - padding, padding]);

                    var rScale = d3.scale.linear()
                                         .domain([0, d3.max(dataset2003, function(d) { return d[1]; })+d3.max(dataset2003, function(d) { return d[2]; })])
                                         .range([1, 20]);

                    //Define X axis
                    var xAxis = d3.svg.axis()
                                      .scale(xScale)
                                      .orient("bottom")
                                      .ticks(7);

                    //Define Y axis
                    var yAxis = d3.svg.axis()
                                      .scale(yScale)
                                      .orient("left")
                                      .ticks(7);

                    //Create SVG element
                    var svg = d3.select("body")
                                .append("svg")
                                .attr("width", w)
                                .attr("height", h);

                    //Create circles
                    svg.selectAll("circle")
                       .data(dataset2003)
                       .enter()
                       .append("circle")
                       .attr("cx", function(d) {
                            return xScale(d[2]);
                       })
                       .attr("cy", function(d) {
                            return yScale(d[1]);
                       })
                       .attr("r", function(d) {
                            return rScale(d[2]+d[1]);
                        })
                       .attr('fill',function(d){
                            var a=d[1];
                            var b=d[2];
                            var c=maxVehicletheft2003;
                            var d=maxProstitution2003;
                            var e=Math.floor(((a+b)/(c+d))*256);
                            return 'rgb('+ e +','+ (255-e) +',0)';
                       });

                    svg.append("clipPath")    
                        .attr("id", "chart-area")   
                        .append("rect") 
                        .attr("x", padding)
                        .attr("y", padding-20)
                        .attr("width", w - padding * 3+20)
                        .attr("height", h-padding*2+20);

                    //Add labels   
                    svg.selectAll("text")
                               .data(dataset2003)
                               .enter()
                               .append("text")
                               .text(function(d) {
                                    return d[0];
                               })
                               .attr("x", function(d) {
                                    return xScale(d[2])+rScale(d[2]+d[1])/Math.sqrt(2);
                               })
                               .attr("y", function(d) {
                                    return yScale(d[1])-rScale(d[2]+d[1])/Math.sqrt(2);
                               })
                               .attr("font-family", "sans-serif")
                               .attr("font-size", "11px")
                               .attr("fill", "black");
                    
                    //Create X axis
                    svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + (h - padding) + ")")
                        .call(xAxis);
                    
                    //Create Y axis
                    svg.append("g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(" + padding + ",0)")
                        .call(yAxis);

                    svg.append("rect")                             
                       .attr("id", "circles")                   
                       .attr("clip-path", "url(#chart-area)")   
                       .selectAll("circle")                     
                       .data(dataset2003)
                       .enter()
                       .append("circle");

                    d3.select("p")
                        .on("click", function() {

                            if (x==dataset2003){
                                dataset = dataset2015;
                                x=dataset2015;
                            }    
                            else {
                                dataset = dataset2003;
                                x=dataset2003;
                            }

                            //Update all circles
                            svg.selectAll("circle")
                               .data(dataset)
                               .transition()
                               .duration(1000)
                               .attr("cx", function(d) {
                                    return xScale(d[2]);
                               })
                               .attr("cy", function(d) {
                                    return yScale(d[1]);
                               })
                               .attr("r", function(d) {
                                return rScale(d[2]+d[1]);
                                })
                               .attr('fill',function(d){
                                    var a=d[1];
                                    var b=d[2];
                                    var c=maxVehicletheft2003;
                                    var d=maxProstitution2003;
                                    var e=Math.floor(((a+b)/(c+d))*256);
                                    return 'rgb('+ e +','+ (255-e) +',0)';
                               });

                            svg.selectAll("text")
                                   .data(dataset)
                                   .transition()   
                                   .duration(1000)
                                   .text(function(d) {
                                        return d[0];
                                   })
                                   .attr("x", function(d) {
                                    return xScale(d[2])+rScale(d[2]+d[1])/Math.sqrt(2);
                                   })
                                   .attr("y", function(d) {
                                        return yScale(d[1])-rScale(d[2]+d[1])/Math.sqrt(2);
                                   });

                        });
                });

             
        </script>
        <br>

        <!--Assignment 2C-->
        <p>Click on this text to toggle between crimes of prostitution and vehicle theft in 2003!</p>

        <script>

        var dataset1=[['BAYVIEW',2121,11],
                                    ['CENTRAL',1193,70],
                                    ['INGLESIDE',2319,5],
                                    ['MISSION',2063,713],
                                    ['NORTHERN',1879,581],
                                    ['PARK',1207,2],
                                    ['RICHMOND',1081,15],
                                    ['SOUTHERN',1426,18],
                                    ['TARAVAL',1665,10],
                                    ['TENDERLOIN',371,527]];
            //Width and height
            var w = 500;
            var h = 800;
            var barPadding = 1;
            //Create SVG element
            var svg1 = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
            svg1.selectAll("rect")
                       .data(dataset1)
                       .enter()
                       .append("rect")
                       .attr({
                            x: function(d, i) { return i * (w / dataset1.length); },
                            y: function(d) { return h - (d[2]); },
                            width: w / dataset1.length - barPadding,
                            height: function(d) { return d[2] ; },
                            fill: function(d) { return "rgb(0, 0, " + (d[2] * 10) + ")"; }
                       });
            svg1.selectAll("text")
                       .data(dataset1)
                       .enter()
                       .append("text")
                       .text(function(d) {
                            return d[0];
                       })
                       .attr("text-anchor", "middle")
                       .attr("x", function(d, i) {
                            return i * (w / dataset1.length) + (w / dataset1.length - barPadding) / 2;
                        })
                       .attr("y", function(d) {
                            return h - (d[2])+14;
                       })
                       .attr("font-family", "sans-serif")
                       .attr("font-size", "11px")
                       .attr("fill", "white");

        </script>

    </body>
</html>